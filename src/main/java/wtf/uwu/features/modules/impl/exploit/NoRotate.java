package wtf.uwu.features.modules.impl.exploit;

import net.minecraft.network.Packet;
import net.minecraft.network.play.client.C03PacketPlayer;
import wtf.uwu.events.annotations.EventTarget;
import wtf.uwu.events.impl.packet.PacketEvent;
import wtf.uwu.events.impl.player.TeleportEvent;
import wtf.uwu.features.modules.Module;
import wtf.uwu.features.modules.ModuleCategory;
import wtf.uwu.features.modules.ModuleInfo;
import wtf.uwu.features.values.impl.ModeValue;

@ModuleInfo(name = "NoRotate", category = ModuleCategory.Exploit)
public class NoRotate extends Module {
    public final ModeValue mode = new ModeValue("Mode", new String[]{"Edit","Packet"}, "Edit", this);
    private float yaw, pitch;
    private boolean teleport;

    @EventTarget
    public void onTeleport(TeleportEvent event) {

        if (getModule(Disabler.class).options.isEnabled("Watchdog Motion") && getModule(Disabler.class).testTicks == -1 || !getModule(Disabler.class).options.isEnabled("Watchdog Motion")) {

            switch (mode.get()) {
                case "Packet":
                    event.setYaw(mc.thePlayer.rotationYaw);
                    event.setPitch(mc.thePlayer.rotationPitch);
                    break;
                case "Edit":
                    this.yaw = event.getYaw();
                    this.pitch = event.getPitch();

                    event.setYaw(mc.thePlayer.rotationYaw);
                    event.setPitch(mc.thePlayer.rotationPitch);

                    this.teleport = true;
                    break;
            }
        }
    }

    @EventTarget
    private void onPacket(PacketEvent event) {
        Packet<?> packet = event.getPacket();

        if (mode.is("Edit") && this.teleport && packet instanceof C03PacketPlayer.C06PacketPlayerPosLook c06PacketPlayerPosLook) {

            c06PacketPlayerPosLook.yaw = this.yaw;
            c06PacketPlayerPosLook.pitch = this.pitch;

            event.setPacket(c06PacketPlayerPosLook);

            this.teleport = false;
        }
    }
}
